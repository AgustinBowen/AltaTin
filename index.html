<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUDitin</title>
</head>
<style>
    @font-face {
        font-family: 'evanescent';
        src: url('./fonts/evanescent.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }
    
    body {
        font-family: 'evanescent', monospace;
        background-color: #000000;
        color: #ffff;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow-x: hidden;
        position: relative;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('./backgroundGhotic.jpg') no-repeat center center fixed;
        background-size: cover;
        z-index: -2;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('./gif2.gif') repeat;
        background-size: cover; 
        pointer-events: none;
        z-index: -1;
        opacity: 0.5; 
    }

    .container {
        border: 1px solid #888888;
        padding: 4px;
        position: relative;
        top: 20px;
        background-color: rgba(0, 0, 0, 1); 
        max-width: 95%;
        overflow-y: auto; 
        margin-bottom: 150px;
        z-index: 10;
    }


    .main-layout {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }


    .sidebar-left {
        width: 200px;
        border: 1px solid #888888;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }


    .main-content {
        flex: 1;
        padding: 0 10px;
    }


    .sidebar-right {
        width: 200px;
        border: 1px solid #888888;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }


    .sidebar-section {
        margin-bottom: 20px;
        border: 1px solid #888888;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
    }

    .sidebar-title {
        color: #008cff;
        font-size: 15px;
        margin-bottom: 10px;
        border-bottom: 1px solid #888888;
        padding-bottom: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
    }


    h1{
        color: #f7f7f7;
        margin-block: 0;
    }
    p{
        color: #008cff;
    }
    input{
        background-color: #000000;
        color: #ffffff;
        height: 14px;
        padding: 10px;
        width: auto;
        border: 4px inset #c2c2c2;
    }
    button{
        background-color: #000000;
        color: #ffffff;
        height: 45px;
        padding: 10px;
        width: auto;
        border:none;
        text-decoration: underline;
        border: 1px solid #888888;
    }
    .error {
        color: red;
        font-size: 12px;
        margin-top: -10px;
        margin-bottom: 10px;
        display: block;
    }
    button:hover{
        cursor: pointer;
    }
    input::placeholder{
        color: #afafaf;
    }
    table{
        background-color: #000000;
        border: 1px solid #888888;
        padding: 15px;
        width: 100%;
    }
    table > tbody > tr > td{
        padding: 10px;
        border: 1px solid #888888;
        font-size: 25px; 
    }
    .contenedor-tabla{
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .acciones{
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    header{
        background: url('./headerbackground.jpg') no-repeat center center;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        border: 1px double #888888;
        margin-bottom: 20px;
    }
    footer{
        background-color: #000000;
        color: #008cff;
        text-align: center;
        padding: 10px;
        border: 1px solid #888888;
        margin-top: 4px;
        background: url('./headerBackground.jpg') no-repeat center center;
    }

    #formAgregarCliente{
        background-color: #000000;
        padding: 20px;
        border: 1px solid #888888;
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 300px;
    }
    .contenedorFormulario {
        display: none;
        position: fixed;   
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); 
        background-color: #000;
        padding: 4px;
        border: 1px solid #888888;
        z-index: 100; 
    }
    .active {
        display: block;
    }
    thead{
        background-color: #222222;
        font-weight: bold;
    }
    thead > tr > td{
        padding: 10px;
        font-size: 25px; 
    }
    .containerTituloContent {
        border: 1px solid #ffffff;
        margin: 0;
        display: flex;
        align-items: center;
        height: 30px; 
        margin-bottom: 10px;
        width: 100%;
        overflow: hidden; 
        position: relative;
    }

    .containerTituloContent h2 {
        color: #008cff;
        margin: 0;
        white-space: nowrap; 
        position: absolute;
        animation: moveText 4s linear infinite; 
    }

    .makerContent,
    .makerContent2 {
        position: relative;      
        overflow: hidden;        
    }
    .makerContent::before,
    .makerContent2::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-repeat: no-repeat;   
        background-position: center;    
        background-size: cover;        
        opacity: 1;                  
        z-index: -1;
    }

    .makerContent::before {
        background-image: url('./paramore.gif');
    }
    .makerContent2::before {
        background-image: url('./evanescence.gif');
    }

    @keyframes moveText {
        from {
            transform: translateX(900%);   
        }
        to {
            transform: translateX(-100%); 
        }
    }

    @media (max-width: 1200px) {
        .sidebar-left,
        .sidebar-right {
            width: 180px;
        }
    }

    @media (max-width: 900px) {
        .main-layout {
            flex-direction: column;
        }
        
        .sidebar-left,
        .sidebar-right {
            width: 100%;
        }
    }
</style>
<body>
<body>
    <div class="container">
        <header>
            <h1 style="font-size: 60px; margin-bottom: 0;">ClienTín</h1>
            <p style="font-size: 20px; margin-top:0; font-weight:bold;">El mejor creador de clientes del universo</p>
            <nav class="acciones">
                <input type="text" placeholder="Nombre,Apellido,Dni" id="buscador">
                <button type="button" id="btnAbrirFormulario">Agregar Cliente</button>
            </nav>
        </header>

        <div class="main-layout">
            <!-- Sidebar Izquierdo -->
            <aside class="sidebar-left">
                <div class="sidebar-section makerContent">
                    <h2>Architín777</h2>
                </div>
                <div class="sidebar-section">
                    <img src="./mascota.gif" alt="mascota" style="width: 100%; height: auto; border-radius: 10px;">
                </div>
                <div class="sidebar-section makerContent">
                    <h2>Architín777</h2>
                </div>
            </aside>

            <!-- Contenido Central -->
            <main class="main-content">
                <section class="contenedor-tabla">
                    <div class="containerTituloContent">
                        <h2 style="color:#008cff; margin:0;">Clientes</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <td>DNI</td>
                                <td>Nombre</td>
                                <td>Apellido</td>
                                <td>Email</td>
                                <td>Telefono</td>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </section>
            </main>

            <!-- Sidebar Derecho -->
            <aside class="sidebar-right">
                <div class="sidebar-section makerContent2">
                    <h2>Architín777</h2>
                </div>
                <div class="sidebar-section">
                    <img src="./mascota.gif" alt="mascota" style="width: 100%; height: auto; border-radius: 10px;">
                </div>
                <div class="sidebar-section makerContent2">
                    <h2>Architín777</h2>
                </div>
            </aside>
        </div>
        
        <!-- Formulario Modal -->
        <section class="contenedorFormulario">
            <form method="POST" action="/clientes" id="formAgregarCliente">
                <div class="formHeader" style="display: flex; justify-content: space-between; align-items: center;">
                    <h1>Agregar Cliente</h1>
                    <button type="button" style="width: 40px;" id="btnCerrarForm">X</button>
                </div>
                <input type="number" name="DNI" id="DNI" placeholder="DNI">
                <span class="error" id="errorDNI"></span>

                <input type="text" name="nombre" id="nombre" placeholder="Nombre">
                <span class="error" id="errorNombre"></span>

                <input type="text" name="apellido" id="apellido" placeholder="Apellido">
                <span class="error" id="errorApellido"></span>

                <input type="email" name="email" id="email" placeholder="verstappen@gmail.com">
                <span class="error" id="errorEmail"></span>

                <input type="text" name="telefono" id="telefono" placeholder="2804929292">
                <span class="error" id="errorTelefono"></span>
                <button type="submit" id="btnAgregar">Agregar</button>
            </form>
        </section>
        <footer>
            <h2>by Architín777</h2>
        </footer>
    </div>

<script type="module">
    const url = "/clientes"
    const btnAbrirFormulario = document.getElementById("btnAbrirFormulario")
    const contenedorFormulario = document.querySelector(".contenedorFormulario")
    const btnCerarrFormulario = document.getElementById("btnCerrarForm")
    const btnAgregar = document.getElementById("btnAgregar")
    const form = document.getElementById("formAgregarCliente")
    let clientes = [];
    btnAbrirFormulario.addEventListener('click',formularioHandler)
    btnCerarrFormulario.addEventListener('click',formularioHandler)
    const buscador = document.getElementById("buscador");

    buscador.addEventListener("input", () => {
        const texto = buscador.value.toLowerCase();

        const filtrados = clientes.filter(c => 
            c.DNI.toString().includes(texto) ||
            c.nombre.toLowerCase().includes(texto) ||
            c.apellido.toLowerCase().includes(texto)
        );

        renderTabla(filtrados);
    });

    function renderTabla(lista) {
        document.querySelector("tbody").innerHTML = lista.map(item => `
            <tr>
                <td>${item.DNI}</td>
                <td>${item.nombre}</td>
                <td>${item.apellido}</td>
                <td>${item.email}</td>
                <td>${item.telefono}</td>
            </tr>
        `).join("");
    }

    try {
        const data = await fetch(url);
        if (!data.ok) {
            throw new Error(`Response status: ${data.status}`);
        }
        clientes = await data.json();
        
        renderTabla(clientes);
    } catch (error) {
        console.log(error);
    }
    
    function formularioHandler(){
        if(!contenedorFormulario.classList.contains("active")){
            contenedorFormulario.classList.add("active")
        }else{
            contenedorFormulario.classList.remove("active")
        }
    }

    form.addEventListener('submit', event => {
        event.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        // Expresiones regulares
        const regexNombre = /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/;
        const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const regexTelefono = /^[0-9-]+$/;

        // Reset de errores
        document.querySelectorAll(".error").forEach(el => el.textContent = "");

        let valido = true;

        if (!regexNombre.test(data.nombre)) {
            document.getElementById("errorNombre").textContent = "El nombre solo puede contener letras.";
            valido = false;
        }
        if (!regexNombre.test(data.apellido)) {
            document.getElementById("errorApellido").textContent = "El apellido solo puede contener letras.";
            valido = false;
        }
        if (!regexEmail.test(data.email)) {
            document.getElementById("errorEmail").textContent = "El email no es válido.";
            valido = false;
        }
        if (!regexTelefono.test(data.telefono)) {
            document.getElementById("errorTelefono").textContent = "El teléfono solo puede contener números y '-'.";
            valido = false;
        }

        if (!valido) return;

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(res => {
            if (!res.ok) {
                return res.json().then(err => { throw err; });
            }
            return res.json();
        }).then(respuesta => {
            clientes.push(data);
            renderTabla(clientes);
            form.reset();
            contenedorFormulario.classList.remove("active");
        }).catch(error => {
            if (error.errores) {
                if (error.errores.nombre) document.getElementById("errorNombre").textContent = error.errores.nombre;
                if (error.errores.apellido) document.getElementById("errorApellido").textContent = error.errores.apellido;
                if (error.errores.email) document.getElementById("errorEmail").textContent = error.errores.email;
                if (error.errores.telefono) document.getElementById("errorTelefono").textContent = error.errores.telefono;
            }
        });

    });
</script>
</body>
</html>